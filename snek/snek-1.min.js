(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol=root.Symbol,splice=arrayProto.splice;var Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}module.exports=get}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){var funcTag="[object Function]",genTag="[object GeneratorFunction]";var objectProto=Object.prototype;var objectToString=objectProto.toString;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=isFunction},{}],3:[function(require,module,exports){function isNil(value){return value==null}module.exports=isNil},{}],4:[function(require,module,exports){var stringTag="[object String]";var objectProto=Object.prototype;var objectToString=objectProto.toString;var isArray=Array.isArray;function isObjectLike(value){return!!value&&typeof value=="object"}function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&objectToString.call(value)==stringTag}module.exports=isString},{}],5:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var reIsUint=/^(?:0|[1-9]\d*)$/;function arrayMap(array,iteratee){var index=-1,length=array?array.length:0,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function overArg(func,transform){return function(arg){return func(transform(arg))}}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var nativeFloor=Math.floor,nativeKeys=overArg(Object.keys,Object),nativeRandom=Math.random;function arrayLikeKeys(value,inherited){var result=isArray(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isIndex(key,length)))){result.push(key)}}return result}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function sample(collection){var array=isArrayLike(collection)?collection:values(collection),length=array.length;return length>0?array[baseRandom(0,length-1)]:undefined}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function values(object){return object?baseValues(object,keys(object)):[]}module.exports=sample},{}],6:[function(require,module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsUint=/^(?:0|[1-9]\d*)$/;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol=root.Symbol,splice=arrayProto.splice;var Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString(value){return value==null?"":baseToString(value)}function set(object,path,value){return object==null?object:baseSet(object,path,value)}module.exports=set}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],7:[function(require,module,exports){"use strict";var _souls=require("./souls/souls");var _snek=require("./snek");function main(){var args={assets:window.ASSETS,width:1920,height:1080};(0,_souls.souls)(args,function(){this.setScene(_snek.snek)})}window.addEventListener("load",main,false)},{"./snek":8,"./souls/souls":18}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.snek=snek;var _souls=require("./souls/souls");function build(){this.add("game").c(null);this.add("head").p("game").as(.5,.5).c(["head","booped"]);this.add("tail").p("game").as(.5,.5);this.add("finger").p("game").as(.5,.5);this.add("points").c(function(){return new PIXI.Text("")}).a(.5)}var BLOCK=60;var WIDTH=1920/BLOCK;var HEIGHT=1080/BLOCK;var MOVES={up:function up(d){return d.y-=1},right:function right(d){return d.x+=1},down:function down(d){return d.y+=1},left:function left(d){return d.x-=1}};var OPPOSITES={up:"down",right:"left",down:"up",left:"right"};var ANGLES={up:Math.PI*.5,right:Math.PI*1,down:Math.PI*1.5,left:0};var KEYS={arrowup:"up",arrowright:"right",arrowdown:"down",arrowleft:"left",w:"up",d:"right",s:"down",a:"left"};function snek(){var highScore=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var self=new _souls.Scene;var I=self.images;var head,tail,finger;var facing=null;var moving=facing;var speed=10;var ticks=0;var grow=0;var points=0;var high=highScore;self.setUp=function(){self.buildAssets(build);var match=/speed=(\d+)/.exec(window.location.search);if(match){var s=+match[1];if(!isNaN(s)&&s>0){speed=s}}var _self$findImages=self.findImages("head","tail","finger");var _self$findImages2=_slicedToArray(_self$findImages,3);head=_self$findImages2[0];tail=_self$findImages2[1];finger=_self$findImages2[2];head.userData={x:16,y:9,next:tail};tail.userData={x:17,y:9,next:null};randomizeFinger();window.addEventListener("keydown",onKey)};self.tearDown=function(){window.removeEventListener("keydown",onKey)};function onKey(e){var dir=KEYS[e.key.toLowerCase()];if(dir){if(OPPOSITES[dir]!==moving){facing=dir}e.preventDefault()}}function hit(a,b){return a.userData.x===b.userData.x&&a.userData.y===b.userData.y}function fingerInSnek(){for(var part=head;part;part=part.userData.next){if(hit(finger,part)){return true}}return false}function randomizeFinger(){finger.userData={x:Math.floor(Math.random()*WIDTH),y:Math.floor(Math.random()*HEIGHT)};while(fingerInSnek()){if(++finger.userData.x>=WIDTH){finger.userData.x=0;if(++finger.userData.y>=HEIGHT){finger.userData.y=0}}}}function moveSnek(){var px=head.userData.x;var py=head.userData.y;MOVES[facing](head.userData);head.rotation=ANGLES[facing];moving=facing;if(head.booped=hit(head,finger)){++grow;++points}if(grow>0){--grow;var piece=head.userData.next=self.add({content:["straight","left","right"],parent:"game",anchorX:.5,anchorY:.5,userData:{x:px,y:py,next:head.userData.next}});show(piece);angle(head,piece)}else{for(var part=head.userData.next;part;part=part.userData.next){var ppx=px;var ppy=py;px=part.userData.x;py=part.userData.y;part.userData.x=ppx;part.userData.y=ppy}}if(head.booped){randomizeFinger()}}function checkLoss(){if(head.userData.x<0||head.userData.x>=WIDTH||head.userData.y<0||head.userData.y>=HEIGHT){self.soul.setScene(snek.bind(void 0,Math.max(points,high)));return}for(var part=head.userData.next;part;part=part.userData.next){if(hit(head,part)){self.soul.setScene(snek.bind(void 0,Math.max(points,high)));return}}}function onLogic(){ticks=(ticks+1)%speed;if(ticks===0&&facing){moveSnek()}checkLoss()}function show(img){img.x=img.userData.x*BLOCK+BLOCK/2;img.y=img.userData.y*BLOCK+BLOCK/2}function frame(img,i){if("gotoAndStop"in img){img.gotoAndStop(i)}}function angle(prev,part){var px=prev.userData.x;var py=prev.userData.y;var cx=part.userData.x;var cy=part.userData.y;var next=part.userData.next;var nx=next&&next.userData.x;var ny=next&&next.userData.y;if(py<cy){if(next&&nx>cx){frame(part,2);part.rotation=0}else if(next&&nx<cx){frame(part,1);part.rotation=Math.PI*1}else{frame(part,0);part.rotation=Math.PI*.5}}else if(px>cx){if(next&&ny>cy){frame(part,2);part.rotation=Math.PI*.5}else if(next&&ny<cy){frame(part,1);part.rotation=Math.PI*1.5}else{frame(part,0);part.rotation=Math.PI}}else if(py>cy){if(next&&nx>cx){frame(part,1);part.rotation=Math.PI*0}else if(next&&nx<cx){frame(part,2);part.rotation=Math.PI*1}else{frame(part,0);part.rotation=Math.PI*1.5}}else{if(next&&ny>cy){frame(part,1);part.rotation=Math.PI*.5}else if(next&&ny<cy){frame(part,2);part.rotation=Math.PI*1.5}else{frame(part,0);part.rotation=0}}}function onRender(){frame(head,head.booped?1:0);for(var prev,part=head;part;prev=part,part=part.userData.next){show(part);if(prev){angle(prev,part)}}show(finger);finger.rotation=Math.atan2(finger.y-head.y,finger.x-head.x)+Math.PI;I.points.text=high>0?points+" / "+high:""+points}self.onTick=function(rendered){onLogic();onRender()};return self}},{"./souls/souls":18}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.linear=linear;exports.backIn=backIn;exports.backOut=backOut;exports.backInOut=backInOut;exports.bounceIn=bounceIn;exports.bounceOut=bounceOut;exports.bounceInOut=bounceInOut;exports.cubicIn=cubicIn;exports.cubicOut=cubicOut;exports.cubicInOut=cubicInOut;exports.elasticIn=elasticIn;exports.elasticOut=elasticOut;exports.elasticInOut=elasticInOut;exports.expoIn=expoIn;exports.expoOut=expoOut;exports.expoInOut=expoInOut;exports.quadIn=quadIn;exports.quadOut=quadOut;exports.quadInOut=quadInOut;exports.quartIn=quartIn;exports.quartOut=quartOut;exports.quartInOut=quartInOut;exports.quintIn=quintIn;exports.quintOut=quintOut;exports.quintInOut=quintInOut;exports.sineIn=sineIn;exports.sineOut=sineOut;exports.sineInOut=sineInOut;function linear(k){return k}function backIn(k){return k*k*((1.70158+1)*k-1.70158)}function backOut(k){return(k=k-1)*k*((1.70158+1)*k+1.70158)+1}function backInOut(k){if((k/=.5)<1){return.5*(k*k*((1.70158*1.525+1)*k-1.70158*1.525))}else{return.5*((k-=2)*k*((1.70158*1.525+1)*k+1.70158*1.525)+2)}}function bOut(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}}function bIn(t,b,c,d){return c-bOut(d-t,0,c,d)+b}function bounceIn(k){return bIn(k,0,1,1)}function bounceOut(k){return bOut(k,0,1,1)}function bounceInOut(k){if(k<.5){return bIn(k*2,0,1,1)*.5}else{return bOut(k*2-1,0,1,1)*.5+1*.5}}function cubicIn(k){return k*k*k}function cubicOut(k){return--k*k*k+1}function cubicInOut(k){if((k/=1/2)<1){return.5*k*k*k}else{return.5*((k-=2)*k*k+2)}}function elasticIn(k){if(k==0||k==1){return k}return-(Math.exp(6.931471805599453*(k-=1))*Math.sin((k-.4/(2*Math.PI)*Math.asin(1))*(2*Math.PI)/.4))}function elasticOut(k){if(k==0||k==1){return k}return Math.exp(-6.931471805599453*k)*Math.sin((k-.4/(2*Math.PI)*Math.asin(1))*(2*Math.PI)/.4)+1}function elasticInOut(k){if(k==0){return 0}if((k/=1/2)==2){return 1}if(k<1){return-.5*(Math.exp(6.931471805599453*(k-=1))*Math.sin((k-.1125)*(2*Math.PI)/.45))}else{return Math.exp(-6.931471805599453*(k-=1))*Math.sin((k-.1125)*(2*Math.PI)/.45)*.5+1}}function expoIn(k){return k==0?0:Math.exp(6.931471805599453*(k-1))}function expoOut(k){return k==1?1:1-Math.exp(-6.931471805599453*k)}function expoInOut(k){if(k==0||k==1){return k}if((k/=1/2)<1){return.5*Math.exp(6.931471805599453*(k-1))}else{return.5*(2-Math.exp(-6.931471805599453*--k))}}function quadIn(k){return k*k}function quadOut(k){return-k*(k-2)}function quadInOut(k){if((k*=2)<1){return 1/2*k*k}else{return-1/2*((k-1)*(k-3)-1)}}function quartIn(k){return k*k*k*k}function quartOut(k){return-(--k*k*k*k-1)}function quartInOut(k){if((k*=2)<1){return.5*k*k*k*k}else{return-.5*((k-=2)*k*k*k-2)}}function quintIn(k){return k*k*k*k*k}function quintOut(k){return--k*k*k*k*k+1}function quintInOut(k){if((k*=2)<1){return.5*k*k*k*k*k}else{return.5*((k-=2)*k*k*k*k+2)}}function sineIn(k){return 1-Math.cos(k*(Math.PI/2))}function sineOut(k){return Math.sin(k*(Math.PI/2))}function sineInOut(k){return-(Math.cos(Math.PI*k)-1)/2}var LN=exports.LN=linear;var BI=exports.BI=bounceIn;var BO=exports.BO=bounceOut;var BIO=exports.BIO=bounceInOut;var CI=exports.CI=cubicIn;var CO=exports.CO=cubicOut;var CIO=exports.CIO=cubicInOut;var EI=exports.EI=elasticIn;var EO=exports.EO=elasticOut;var EIO=exports.EIO=elasticInOut;var KI=exports.KI=backIn;var KO=exports.KO=backOut;var KIO=exports.KIO=backInOut;var NI=exports.NI=quintIn;var NO=exports.NO=quintOut;var NIO=exports.NIO=quintInOut;var QI=exports.QI=quadIn;var QO=exports.QO=quadOut;var QIO=exports.QIO=quadInOut;var RI=exports.RI=quartIn;var RO=exports.RO=quartOut;var RIO=exports.RIO=quartInOut;var SI=exports.SI=sineIn;var SO=exports.SO=sineOut;var SIO=exports.SIO=sineInOut;var XI=exports.XI=expoIn;var XO=exports.XO=expoOut;var XIO=exports.XIO=expoInOut},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SequenceBuilder=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _util=require("../util");var _steps=require("./steps");var _tweenBuilder=require("./tween-builder");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SequenceBuilder=exports.SequenceBuilder=function(){function SequenceBuilder(scene,topic,ease,name){_classCallCheck(this,SequenceBuilder);this.scene=scene;this.topic=topic;this.ease=ease;this.name=name;this.steps=[]}_createClass(SequenceBuilder,[{key:"addStep",value:function addStep(s){this.steps.push(s);return this}},{key:"bindStep",value:function bindStep(fn,args){return this.addStep(function(){return fn.apply(void 0,args)})}},{key:"call",value:function call(fn){return this.bindStep(_steps.call,[fn])}},{key:"cancelIf",value:function cancelIf(fn){return this.bindStep(_steps.cancelIf,[fn])}},{key:"continueIf",value:function continueIf(fn){return this.bindStep(_steps.continueIf,[fn])}},{key:"delay",value:function delay(a,b){return this.bindStep(_steps.delay,[(0,_util.desugarRand)(a,b)])}},{key:"tween",value:function tween(fields,time,ease,topic){return this.bindStep(_steps.tween,[topic||this.topic,fields,time,ease||this.ease])}},{key:"run",value:function run(runs,complete,userData){var sequencer=this.scene.sequencer;var steps=this.steps.map(function(s){return s()});return sequencer.add(this.name,this.topic,steps,runs,complete,userData)}},{key:"loop",value:function loop(){var runs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Infinity;var complete=arguments[1];var userData=arguments[2];return this.run(runs,complete,userData)}},{key:"start",value:function start(complete,userData){return this.run(1,complete,userData)}},{key:"map",get:function get(){return new _tweenBuilder.TweenBuilder(this)}},{key:"mip",get:function get(){return new _tweenBuilder.TweenBuilder(this,true)}}]);return SequenceBuilder}()},{"../util":19,"./steps":12,"./tween-builder":13}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Sequencer=exports.Sequence=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require("lodash.isnil");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Sequence=exports.Sequence=function(){function Sequence(id,name,topic,steps,until,complete,userData){_classCallCheck(this,Sequence);this.id=id;this.name=(0,_lodash2.default)(name)?""+id:name;this.topic=topic;this.until=until;this.complete=complete;this.steps=steps;this.userData=(0,_lodash2.default)(userData)?Object.create(null):userData;this.index=0;this.runs=0;this.killed=false}_createClass(Sequence,[{key:"kill",value:function kill(){this.killed=true}},{key:"bury",value:function bury(){if(this.killed){return true}else if(this.runs>=this.until){if(this.complete){this.complete(this.userData)}return true}else{return false}}},{key:"next",value:function next(){if(++this.index>=this.steps.length){this.index=0;++this.runs}}},{key:"animate",value:function animate(mult){while(!this.killed&&this.runs<this.until&&this.steps[this.index](this,mult)){this.next()}}}]);return Sequence}();var Sequencer=exports.Sequencer=function(){function Sequencer(){_classCallCheck(this,Sequencer);this.counter=0;this.sequences=[]}_createClass(Sequencer,[{key:"add",value:function add(name,topic,steps,runs,complete,userData){if(name){this.killByName(name)}var id=++this.counter;var seq=new Sequence(id,name,topic,steps,runs,complete,userData);this.sequences.push(seq);return id}},{key:"killBy",value:function killBy(pred){var killed=0;for(var _iterator=this.sequences,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var seq=_ref;if(pred(seq)){seq.kill();++killed}}return killed}},{key:"killById",value:function killById(id){return this.killBy(function(seq){return seq.id===id})}},{key:"killByName",value:function killByName(name){return this.killBy(function(seq){return seq.name===name})}},{key:"killByTopic",value:function killByTopic(topic){return this.killBy(function(seq){return seq.topic===topic})}},{key:"killByRegex",value:function killByRegex(regex){return this.killBy(function(seq){return regex.test(seq.name)})}},{key:"killAll",value:function killAll(){for(var _iterator2=this.sequences,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{_i2=_iterator2.next();if(_i2.done)break;_ref2=_i2.value}var seq=_ref2;seq.kill()}this.sequences=[]}},{key:"onTick",value:function onTick(mult){for(var i=0;i<this.sequences.length;++i){this.sequences[i].animate(mult)}this.sequences=this.sequences.filter(function(seq){return!seq.bury()})}}]);return Sequencer}()},{"lodash.isnil":3}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();exports.call=call;exports.cancelIf=cancelIf;exports.continueIf=continueIf;exports.delay=delay;exports.tween=tween;var _easings=require("./easings");var easings=_interopRequireWildcard(_easings);var _util=require("../util");var _lodash=require("lodash.isstring");var _lodash2=_interopRequireDefault(_lodash);var _lodash3=require("lodash.get");var _lodash4=_interopRequireDefault(_lodash3);var _lodash5=require("lodash.set");var _lodash6=_interopRequireDefault(_lodash5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function call(fn){return function(seq,mult){fn(seq.userData);return true}}function cancelIf(fn){return function(seq,mult){if(fn(seq.userData)){seq.kill();return false}else{return true}}}function continueIf(fn){return function(seq,mult){if(!fn(seq.userData)){seq.kill();return false}else{return true}}}function delay(time){var runs=-1;var ticks=-1;return function(seq,mult){if(seq.runs!==runs){runs=seq.runs;ticks=(0,_util.realizeTicks)(time,seq.userData,mult)}return ticks--<=0}}function tween(topic,fields,time,ease){var runs=-1;var until=-1;var props=void 0,i=void 0;if((0,_lodash2.default)(ease)){ease=easings[ease]}function build(userData,mult){until=time?(0,_util.realizeTicks)(time,userData,mult):0;i=0;props=Object.keys(fields).map(function(key){return[key,(0,_lodash4.default)(topic,key),(0,_util.realize)(fields[key],userData)]})}return function(seq,mult){if(seq.runs!==runs){runs=seq.runs;build(seq.userData,mult)}var ratio=until&&i<=until?i/until:1;for(var _iterator=props,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var _ref2=_ref,_ref3=_slicedToArray(_ref2,3),key=_ref3[0],src=_ref3[1],dst=_ref3[2];(0,_lodash6.default)(topic,key,(0,_util.interpolate)(src,dst,ratio,ease))}return i++>=until}}},{"../util":19,"./easings":9,"lodash.get":1,"lodash.isstring":4,"lodash.set":6}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TweenBuilder=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _util=require("../util");var _lodash=require("lodash.isfunction");var _lodash2=_interopRequireDefault(_lodash);var _lodash3=require("lodash.sample");var _lodash4=_interopRequireDefault(_lodash3);var _lodash5=require("lodash.set");var _lodash6=_interopRequireDefault(_lodash5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TweenBuilder=exports.TweenBuilder=function(){function TweenBuilder(sequencer){var initial=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_classCallCheck(this,TweenBuilder);this.sequencer=sequencer;this.initial=initial;this.topic=this.sequencer.topic;this.fields=Object.create(null);this.easings=[]}_createClass(TweenBuilder,[{key:"build",value:function build(time){if(this.initial){for(var _iterator=Object.keys(this.fields),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var key=_ref;(0,_lodash6.default)(this.topic,key,(0,_util.realize)(this.fields[key]))}}var ease=this.easings.length===0?this.sequencer.ease:this.easings.length===1?this.easings[0]:_lodash4.default.bind(void 0,this.easings);return this.sequencer.tween(this.fields,time,ease,this.topic)}},{key:"tween",value:function tween(a,b){return this.build((0,_util.desugarRand)(a,b))}},{key:"ease",value:function ease(e){this.easings.push(e);return this}},{key:"set",value:function set(key,a,b){this.fields[key]=(0,_util.desugarRand)(a,b);return this}},{key:"anchorX",value:function anchorX(a,b){return this.set("anchor.x",a,b)}},{key:"anchorY",value:function anchorY(a,b){return this.set("anchor.y",a,b)}},{key:"rotation",value:function rotation(a,b){var degrees=(0,_util.desugarRand)(a,b);var radians=(0,_lodash2.default)(degrees)?function(userData){return(0,_util.rad)(degrees(userData))}:function(userData){return(0,_util.rad)(degrees)};return this.set("rotation",radians)}},{key:"scaleX",value:function scaleX(a,b){return this.set("scale.x",a,b)}},{key:"scaleY",value:function scaleY(a,b){return this.set("scale.y",a,b)}},{key:"scale",value:function scale(a,b){return this.scaleX(a,b).scaleY(a,b)}}]);return TweenBuilder}();var _arr=["x","y","alpha","rotation","scale","ease","tween",["scaleX","sx"],["scaleY","sy"],["anchorX","ax"],["anchorY","ay"]];var _loop=function _loop(){var e=_arr[_i2];var key=Array.isArray(e)?e[0]:e;var alias=Array.isArray(e)?e[1]:e.substr(0,1);if(key&&!TweenBuilder.prototype[key]){TweenBuilder.prototype[key]=function(a,b){this.set(key,a,b);return this}}if(key&&key.length>1&&alias){TweenBuilder.prototype[alias]=TweenBuilder.prototype[key]}};for(var _i2=0;_i2<_arr.length;_i2++){_loop()}},{"../util":19,"lodash.isfunction":2,"lodash.sample":5,"lodash.set":6}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AssetBuilder=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _util=require("./util");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var AssetWrapper=function(){function AssetWrapper(builder,asset){_classCallCheck(this,AssetWrapper);this.builder=builder;this.asset=asset}_createClass(AssetWrapper,[{key:"moveRelative",value:function moveRelative(name,delta){this.builder.move(this.asset.name,this.builder.index(name)+delta);return this}},{key:"before",value:function before(name){return this.moveRelative(name,0)}},{key:"after",value:function after(name){return this.moveRelative(name,1)}},{key:"remove",value:function remove(){this.builder.remove(this.asset.name);return this}},{key:"like",value:function like(name){var oldName=this.asset.name;Object.assign(this.asset,this.builder.find(name));this.asset.name=oldName;return this}},{key:"scale",value:function scale(s){return this.scaleX(s).scaleY(s)}},{key:"anchors",value:function anchors(ax,ay){return this.anchorX(ax).anchorY(ay)}},{key:"frames",value:function frames(prefix,from,inclusiveEnd){return this.content((0,_util.irange)(from,inclusiveEnd).map(function(i){return""+prefix+i}))}},{key:"graphics",value:function graphics(){return this.content(function(name,parent,args){return new PIXI.Graphics})}},{key:"tilingSprite",value:function tilingSprite(content,width,height){return this.content(function(name,parent,args){var c=this.resolveContent(content===void 0?name:content);return new PIXI.extras.TilingSprite(c,width,height)})}}]);return AssetWrapper}();var _arr=["content","parent","x","y","alpha","rotation",["scaleX","sx"],["scaleY","sy"],["scale","s"],["anchorX","ax"],["anchorY","ay"],["anchors","as"]];var _loop=function _loop(){var e=_arr[_i];var key=Array.isArray(e)?e[0]:e;var alias=Array.isArray(e)?e[1]:e.substr(0,1);if(key&&!AssetWrapper.prototype[key]){AssetWrapper.prototype[key]=function(value){this.asset[key]=value;return this}}if(key&&key.length>1&&alias){AssetWrapper.prototype[alias]=AssetWrapper.prototype[key]}};for(var _i=0;_i<_arr.length;_i++){_loop()}var AssetBuilder=exports.AssetBuilder=function(){function AssetBuilder(){_classCallCheck(this,AssetBuilder);this.assets=[];this.isBuilt=false}_createClass(AssetBuilder,[{key:"build",value:function build(){throw"Override me"}},{key:"index",value:function index(name){var fail=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var i=this.assets.findIndex(function(a){return a.name===name});if(i===-1&&fail){throw'Asset does not exist: "'+name+'"'}return i}},{key:"find",value:function find(name){return this.assets[this.index(name)]}},{key:"has",value:function has(name){return this.index(name,false)!==-1}},{key:"validate",value:function validate(){var _this=this;function invalidate(asset,index,message){return'Invalid asset "'+asset.name+'" at index '+index+": "+message}this.assets.forEach(function(asset,index){if(asset.parent){var parentIndex=_this.index(asset.parent,false);if(parentIndex===-1){throw invalidate(asset,index,'parent "'+asset.parent+'" does not exist')}else if(parentIndex>=index){throw invalidate(asset,index,'parent "'+asset.parent+'" appears afterwards')}}})}},{key:"addTo",value:function addTo(scene){if(!this.isBuilt){this.build();this.isBuilt=true}this.validate();for(var _iterator=this.assets,_isArray=Array.isArray(_iterator),_i2=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i2>=_iterator.length)break;_ref=_iterator[_i2++]}else{_i2=_iterator.next();if(_i2.done)break;_ref=_i2.value}var asset=_ref;scene.add(asset)}}},{key:"move",value:function move(name,index){var source=this.index(name);var asset=this.assets[source];this.assets.splice(source,1);this.assets.splice(source<index?index-1:index,0,asset);return this}},{key:"add",value:function add(name){var asset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Object.create(null);if(this.has(name)){throw'Asset already exist: "'+name+'"'}asset.name=name;this.assets.push(asset);return new AssetWrapper(this,asset)}},{key:"edit",value:function edit(name){return new AssetWrapper(this,this.find(name))}},{key:"remove",value:function remove(name){var i=this.index(name);if(i!==-1){this.assets.splice(i,1);return true}else{console.warn('Asset to remove does not exist: "'+name+'"');return false}}},{key:"addMany",value:function addMany(as){for(var _iterator2=as,_isArray2=Array.isArray(_iterator2),_i3=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i3>=_iterator2.length)break;_ref2=_iterator2[_i3++]}else{_i3=_iterator2.next();if(_i3.done)break;_ref2=_i3.value}var a=_ref2;this.add(a)}return this}}]);return AssetBuilder}()},{"./util":19}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Preloader=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _scene=require("./scene");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function defaultArgs(){return{backdrop:16777215,outer:6710886,inner:16777215,round:10,outerRatioX:.9,outerRatioY:.1,innerRatioY:.8}}var Preloader=exports.Preloader=function(_Scene){_inherits(Preloader,_Scene);function Preloader(options){_classCallCheck(this,Preloader);var _this=_possibleConstructorReturn(this,(Preloader.__proto__||Object.getPrototypeOf(Preloader)).call(this));_this.bars=Object.assign(defaultArgs(),options||{});return _this}_createClass(Preloader,[{key:"setUp",value:function setUp(){var graphics=function graphics(){return new PIXI.Graphics};var backdrop=this.add({name:"backdrop",content:graphics});var outer=this.add({name:"outer",content:graphics});var inner=this.add({name:"inner",content:graphics});var sw=this.soul.realWidth;var sh=this.soul.realHeight;var outerH=sh*this.bars.outerRatioY;var outerW=sw*this.bars.outerRatioX;outer.x=(sw-outerW)/2;outer.y=sh/2;var innerH=outerH*this.bars.innerRatioY;var delta=outerH-innerH;var innerW=outerW-delta;inner.x=outer.x+delta/2;inner.y=outer.y;this.drawBackdrop(sw,sh);this.drawOuter(outerW,outerH);this.drawInner(innerW,innerH)}},{key:"drawBackdrop",value:function drawBackdrop(sw,sh){var g=this.findImage("backdrop");g.clear();g.beginFill(this.bars.backdrop);g.drawRect(0,0,sw,sh);g.endFill()}},{key:"drawOuter",value:function drawOuter(outerW,outerH){var g=this.findImage("outer");g.clear();g.beginFill(this.bars.outer);g.drawRoundedRect(0,outerH/-2,outerW,outerH,this.bars.round);g.endFill()}},{key:"drawInner",value:function drawInner(innerW,innerH){var g=this.findImage("inner");g.clear();g.beginFill(this.bars.inner);g.drawRoundedRect(0,innerH/-2,innerW,innerH,this.bars.round);g.endFill();g.scale.x=0}},{key:"onProgress",value:function onProgress(loader,resource){this.findImage("inner").scale.x=loader.progress/100;console.debug(loader.progress,resource)}}]);return Preloader}(_scene.Scene)},{"./scene":16}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Scene=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _assetBuilder=require("./asset-builder");var _sequences=require("./anim/sequences");var _sequenceBuilder=require("./anim/sequence-builder");var _lodash=require("lodash.isfunction");var _lodash2=_interopRequireDefault(_lodash);var _lodash3=require("lodash.isstring");var _lodash4=_interopRequireDefault(_lodash3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Scene=exports.Scene=function(_PIXI$Container){_inherits(Scene,_PIXI$Container);function Scene(){_classCallCheck(this,Scene);var _this=_possibleConstructorReturn(this,(Scene.__proto__||Object.getPrototypeOf(Scene)).call(this));_this.soul=null;_this.tickListener=null;_this.images=Object.create(null);_this.sequencer=new _sequences.Sequencer;return _this}_createClass(Scene,[{key:"setUp",value:function setUp(){}},{key:"doSetUp",value:function doSetUp(soul){this.soul=soul;this.setUp()}},{key:"tearDown",value:function tearDown(){}},{key:"doTearDown",value:function doTearDown(){try{this.tearDown()}catch(e){console.warn("Exception in tearDown",e)}this.soul=null;this.destroy()}},{key:"buildAssets",value:function buildAssets(builder){if((0,_lodash2.default)(builder)){var ab=new _assetBuilder.AssetBuilder;ab.build=builder;ab.addTo(this)}else{builder.addTo(this)}return this}},{key:"findImage",value:function findImage(name){var img=this.images[name];if(img){return img}else{throw'Image not found: "'+name+'"'}}},{key:"findImages",value:function findImages(){for(var _len=arguments.length,names=Array(_len),_key=0;_key<_len;_key++){names[_key]=arguments[_key]}return names.map(this.findImage.bind(this))}},{key:"resolveContent",value:function resolveContent(content){var _this2=this;if((0,_lodash4.default)(content)){return this.soul.findAsset(content)}else if(Array.isArray(content)){return content.map(function(c){return(0,_lodash4.default)(c)?_this2.soul.findAsset(c):c})}else{return content}}},{key:"resolveImage",value:function resolveImage(img){return(0,_lodash4.default)(img)?this.findImage(img):img}},{key:"add",value:function add(options){var args=Object.assign(Object.create(null),options);function del(key){var dflt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var value=args[key];delete args[key];return value===void 0?dflt:value}if(del("debug")){console.debug(args)}var name=del("name");if(name&&this.images[name]){throw'Image already exists: "'+name+'"'}var content=this.resolveContent(del("content",name));var parent=this.resolveImage(del("parent",this));var img=!content?new PIXI.Container:Array.isArray(content)?new PIXI.extras.AnimatedSprite(content):(0,_lodash2.default)(content)?content.call(this,name,parent,args):new PIXI.Sprite(content);if("anchor"in img){img.anchor.set(del("anchorX",0),del("anchorY",0))}img.scale.set(del("scaleX",1),del("scaleY",1));for(var _iterator=Object.keys(args),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var key=_ref;img[key]=args[key]}parent.addChild(img);if(name){this.images[name]=img}return img}},{key:"seq",value:function seq(topic,ease,name){var img=(0,_lodash4.default)(topic)?this.findImage(topic):topic;return new _sequenceBuilder.SequenceBuilder(this,img,ease,name)}},{key:"xeq",value:function xeq(topic,ease,name){this.sequencer.killByTopic(topic);return this.seq(topic,ease,name)}},{key:"onTick",value:function onTick(rendered){}}]);return Scene}(PIXI.Container)},{"./anim/sequence-builder":10,"./anim/sequences":11,"./asset-builder":14,"lodash.isfunction":2,"lodash.isstring":4}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Soul=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _preloader=require("./preloader");var _lodash=require("lodash.isfunction");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function defaultArgs(){return{antialias:true,smoothing:true,roundPixels:false,backgroundColor:16777215,width:1920,height:1080,tickLength:10,ticksCap:100,assets:[],preloader:function preloader(){return new _preloader.Preloader}}}var Soul=exports.Soul=function(_PIXI$Application){_inherits(Soul,_PIXI$Application);function Soul(options,then){_classCallCheck(this,Soul);var args=Object.assign(defaultArgs(),options);PIXI.settings.SCALE_MODE=args.smoothing?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST;var _this=_possibleConstructorReturn(this,(Soul.__proto__||Object.getPrototypeOf(Soul)).call(this,{antialias:args.antialias,roundPixels:args.roundPixels,backgroundColor:args.backgroundColor,width:args.width,height:args.height}));_this.realWidth=args.width;_this.realHeight=args.height;_this.tickLength=args.tickLength;_this.ticksCap=args.ticksCap;_this.assets=null;{var id=void 0;window.addEventListener("resize",function(){if(id){window.clearTimeout(id)}id=window.setTimeout(function(){id=null;_this.onResize()},100)})}_this.lastFrameTime=performance.now()-_this.tickLength;_this.renderer.on("prerender",_this.onFrame.bind(_this));document.body.appendChild(_this.view);_this.onResize();_this.load(args.preloader,args.assets,then);return _this}_createClass(Soul,[{key:"onResize",value:function onResize(){var _this2=this;var setViewMargin=function setViewMargin(x,y){_this2.view.style.marginLeft=x+"px";_this2.view.style.marginTop=y+"px"};var sw=window.innerWidth;var sh=window.innerHeight;var rw=this.realWidth;var rh=this.realHeight;var ratio=void 0;if(rh*(sw/rw)<=sh){ratio=sw/rw;setViewMargin(0,(sh-rh*ratio)/2)}else{ratio=sh/rh;setViewMargin((sw-rw*ratio)/2,0)}this.stage.scale.set(ratio,ratio);this.renderer.resize(this.view.width=rw*ratio,this.view.height=rh*ratio)}},{key:"onFrame",value:function onFrame(){var now=performance.now();var ticks=Math.floor((now-this.lastFrameTime)/this.tickLength);var capped=Math.min(this.ticksCap,ticks);var mult=1e3/this.tickLength;var scene=void 0;this.lastFrameTime+=ticks*this.tickLength;for(var i=0;i<capped;++i){if(scene=this.scene){scene.sequencer.onTick(mult);scene.onTick(i<capped-1)}}}},{key:"load",value:function load(preloader,assets,then){var _this3=this;this.setScene(preloader);for(var _iterator=assets,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var path=_ref;this.loader.add(path)}this.loader.on("progress",this.scene.onProgress.bind(this.scene));this.loader.load(function(){return then.call(_this3)})}},{key:"buildAssets",value:function buildAssets(){var _this4=this;this.assets=this.assets||Object.create(null);var resources=this.loader.resources;var addAsset=function addAsset(key,value){var match=/([^\/\.]+)\.[^\/]+$/.exec(key);var name=match&&match[1];if(!name){console.warn('Weird asset name: "'+key+'"')}if(_this4.assets[name]){console.warn('Duplicate asset: "'+name+'"')}_this4.assets[name||key]=value};for(var _iterator2=Object.keys(resources),_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{_i2=_iterator2.next();if(_i2.done)break;_ref2=_i2.value}var key=_ref2;console.log(resources[key]);if(/\.json$/.test(key)){var textures=resources[key].textures;for(var _iterator3=Object.keys(textures),_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref3;if(_isArray3){if(_i3>=_iterator3.length)break;_ref3=_iterator3[_i3++]}else{_i3=_iterator3.next();if(_i3.done)break;_ref3=_i3.value}var tk=_ref3;addAsset(tk,textures[tk])}}else if(/\.json_image$/.test(key)){}else{addAsset(key,resources[key].texture)}}}},{key:"findAsset",value:function findAsset(name){if(!this.assets){this.buildAssets()}var asset=this.assets[name];if(asset){return asset}else{throw'Asset not found: "'+name+'"'}}},{key:"setScene",value:function setScene(scene){if(this.scene){this.stage.removeChild(this.scene);this.scene.doTearDown()}if(this.scene=(0,_lodash2.default)(scene)?scene():scene){this.scene.doSetUp(this);this.stage.addChild(this.scene)}return this}}]);return Soul}(PIXI.Application)},{"./preloader":15,"lodash.isfunction":2}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Scene=undefined;var _scene=require("./scene");Object.defineProperty(exports,"Scene",{enumerable:true,get:function get(){return _scene.Scene}});exports.souls=souls;var _soul=require("./soul");var _assetBuilder=require("./asset-builder");function souls(options,then){return new _soul.Soul(options,then)}},{"./asset-builder":14,"./scene":16,"./soul":17}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.clamp=clamp;exports.deg=deg;exports.rad=rad;exports.rand=rand;exports.randfn=randfn;exports.irange=irange;exports.realize=realize;exports.realizeTicks=realizeTicks;exports.desugarRand=desugarRand;exports.intersectRects=intersectRects;exports.interpolate=interpolate;var _lodash=require("lodash.isnil");var _lodash2=_interopRequireDefault(_lodash);var _lodash3=require("lodash.isfunction");var _lodash4=_interopRequireDefault(_lodash3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function clamp(val,min,max){return val<min?min:val>max?max:val}function deg(rad){return 180/Math.PI*rad}function rad(deg){return Math.PI/180*deg}function rand(a,b){var low=Math.min(a,b);return low+(Math.max(a,b)-low)*Math.random()}function randfn(a,b){return rand.bind(void 0,a,b)}function irange(start,inclusiveEnd){var step=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var r=[];for(var i=start;i<=inclusiveEnd;i+=step){r.push(i)}return r}function realize(value,userData){return(0,_lodash4.default)(value)?value(userData):value}function realizeTicks(value,userData,mult){return Math.round(realize(value,userData)*mult)}function desugarRand(a,b){if((0,_lodash2.default)(b)){return(0,_lodash2.default)(a)?0:a}else if((0,_lodash2.default)(a)){return b}else{return randfn(realize(a),realize(b))}}function intersectRects(a,b){return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)}function interpolate(a,b,ratio,fn){return a+(b-a)*(fn?fn(ratio):ratio)}},{"lodash.isfunction":2,"lodash.isnil":3}]},{},[7]);